<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating Analysis Specification • Strategus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating Analysis Specification">
<meta property="og:description" content="Strategus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Strategus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CreatingAnalysisSpecification.html">Creating Analysis Specification</a>
    </li>
    <li>
      <a href="../articles/CreatingModules.html">Creating Strategus Modules</a>
    </li>
    <li>
      <a href="../articles/ExecuteStrategus.html">Execute Strategus</a>
    </li>
    <li>
      <a href="../articles/IntroductionToStrategus.html">Introduction to Strategus</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/Strategus/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating Analysis Specification</h1>
                        <h4 data-toc-skip class="author">Anthony G.
Sena</h4>
            
            <h4 data-toc-skip class="date">2023-01-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/Strategus/blob/HEAD/vignettes/CreatingAnalysisSpecification.Rmd" class="external-link"><code>vignettes/CreatingAnalysisSpecification.Rmd</code></a></small>
      <div class="hidden name"><code>CreatingAnalysisSpecification.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="creating-an-analysis-specification">Creating an analysis specification<a class="anchor" aria-label="anchor" href="#creating-an-analysis-specification"></a>
</h2>
<p>This walk through will show how to use <code>Strategus</code> to
define an analysis specification on an example study using cohorts from
the example problem <em>What is the risk of gastrointestinal (GI) bleed
in new users of celecoxib compared to new users of diclofenac?</em> as
described in the <a href="https://ohdsi.github.io/TheBookOfOhdsi/PopulationLevelEstimation.html#PopulationLevelEstimation" class="external-link">Book
Of OHDSI Chapter 12 on Population Level Estimation</a></p>
<div class="section level3">
<h3 id="cohorts-for-the-study">Cohorts for the study<a class="anchor" aria-label="anchor" href="#cohorts-for-the-study"></a>
</h3>
<p>To start, we’ll need to define cohorts and negative control outcomes
to use in our example analysis specification. We’ve included the cohorts
and negative control outcomes in the <code>Strategus</code> package for
this example and the code below will load them for use when assembling
the analysis specification.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortGenerator/" class="external-link">CohortGenerator</a></span><span class="op">)</span></span>
<span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/getCohortDefinitionSet.html" class="external-link">getCohortDefinitionSet</a></span><span class="op">(</span>settingsFileName <span class="op">=</span> <span class="st">"testdata/Cohorts.csv"</span>,</span>
<span>                                              jsonFolder <span class="op">=</span> <span class="st">"testdata/cohorts"</span>,</span>
<span>                                              sqlFolder <span class="op">=</span> <span class="st">"testdata/sql"</span>,</span>
<span>                                              packageName <span class="op">=</span> <span class="st">"Strategus"</span><span class="op">)</span></span>
<span><span class="va">ncoCohortSet</span> <span class="op">&lt;-</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/readCsv.html" class="external-link">readCsv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata/negative_controls_concept_set.csv"</span>,</span>
<span>                                          package <span class="op">=</span> <span class="st">"Strategus"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="cohort-definitions-negative-control-outcomes">Cohort Definitions &amp; Negative Control Outcomes<a class="anchor" aria-label="anchor" href="#cohort-definitions-negative-control-outcomes"></a>
</h4>
<p>This is the list of cohort definitions we will use when assembling
the analysis specification for Strategus.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cohortId"</span>, <span class="st">"cohortName"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>And the negative control outcomes when performing empirical
calibration.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">ncoCohortSet</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="assembiling-hades-modules">Assembiling HADES modules<a class="anchor" aria-label="anchor" href="#assembiling-hades-modules"></a>
</h2>
<p>The building blocks of the <code>Strategus</code> analysis
specification are HADES modules. For purposes of this walk through, a
module is a specific analytic task you would like to perform. As shown
in the subsequent sections, the high-level pattern for using a module
consists of:</p>
<ol style="list-style-type: decimal">
<li>Download the module’s settings function.</li>
<li>Create the module specifications using the settings function(s) from
the module</li>
<li>Compose the analysis pipeline from one or more module settings</li>
</ol>
<div class="section level3">
<h3 id="cohortgenerator-module-settings">CohortGenerator Module Settings<a class="anchor" aria-label="anchor" href="#cohortgenerator-module-settings"></a>
</h3>
<p>The following code downloads the settings functions from the
<code>CohortGeneratorModule</code> which then activates some additional
functions we can use for creating the analysis specification. In the
analysis specification, we will add the cohort definitions and negative
control outcomes to the <code>sharedResources</code> section since these
elements may be used by any of the HADES modules. To do this, we will
use the <code>createCohortSharedResourceSpecifications</code> and
<code>createNegativeControlOutcomeCohortSharedResourceSpecifications</code>
functions respectively. In addition, we will use the
<code>cohortGeneratorModuleSpecifications</code> function to specify the
cohort generation settings.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/OHDSI/CohortGeneratorModule/v0.0.14/SettingsFunctions.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the cohort definition shared resource element for the analysis specification</span></span>
<span><span class="va">cohortDefinitionSharedResource</span> <span class="op">&lt;-</span> <span class="fu">createCohortSharedResourceSpecifications</span><span class="op">(</span></span>
<span>  cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the negative control outcome shared resource element for the analysis specification</span></span>
<span><span class="va">ncoSharedResource</span> <span class="op">&lt;-</span> <span class="fu">createNegativeControlOutcomeCohortSharedResourceSpecifications</span><span class="op">(</span></span>
<span>  negativeControlOutcomeCohortSet <span class="op">=</span> <span class="va">ncoCohortSet</span>,</span>
<span>  occurrenceType <span class="op">=</span> <span class="st">'all'</span>,</span>
<span>  detectOnDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the module specification</span></span>
<span><span class="va">cohortGeneratorModuleSpecifications</span> <span class="op">&lt;-</span> <span class="fu">createCohortGeneratorModuleSpecifications</span><span class="op">(</span></span>
<span>  incremental <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  generateStats <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cohortdiagnostics-module-settings">CohortDiagnostics Module Settings<a class="anchor" aria-label="anchor" href="#cohortdiagnostics-module-settings"></a>
</h3>
<p>The following code creates the
<code>cohortDiagnosticsModuleSpecifications</code> to run cohort
diagnostics on the cohorts in the study.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/OHDSI/CohortDiagnosticsModule/v0.0.6/SettingsFunctions.R"</span><span class="op">)</span></span>
<span><span class="va">cohortDiagnosticsModuleSpecifications</span> <span class="op">&lt;-</span> <span class="fu">createCohortDiagnosticsModuleSpecifications</span><span class="op">(</span></span>
<span>  runInclusionStatistics <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  runIncludedSourceConcepts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  runOrphanConcepts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  runTimeSeries <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  runVisitContext <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  runBreakdownIndexEvents <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  runIncidenceRate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  runCohortRelationship <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  runTemporalCohortCharacterization <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  incremental <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cohortincidence-module-settings">CohortIncidence Module Settings<a class="anchor" aria-label="anchor" href="#cohortincidence-module-settings"></a>
</h3>
<p>The following code creates the
<code>cohortIncidenceModuleSpecifications</code> to perform an incidence
rate analysis for the target cohorts and outcome in this study.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/OHDSI/CohortIncidenceModule/v0.0.5/SettingsFunctions.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OHDSI/CohortIncidence" class="external-link">CohortIncidence</a></span><span class="op">)</span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createCohortRef.html" class="external-link">createCohortRef</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span>, name<span class="op">=</span><span class="st">"Celecoxib"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createCohortRef.html" class="external-link">createCohortRef</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">2</span>, name<span class="op">=</span><span class="st">"Diclofenac"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createCohortRef.html" class="external-link">createCohortRef</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">4</span>, name<span class="op">=</span><span class="st">"Celecoxib Age &gt;= 30"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createCohortRef.html" class="external-link">createCohortRef</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">5</span>, name<span class="op">=</span><span class="st">"Diclofenac Age &gt;= 30"</span><span class="op">)</span></span>
<span><span class="op">)</span>;</span>
<span></span>
<span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createOutcomeDef.html" class="external-link">createOutcomeDef</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span>,name<span class="op">=</span><span class="st">"GI bleed"</span>, cohortId<span class="op">=</span><span class="fl">3</span>, cleanWindow<span class="op">=</span><span class="fl">9999</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createTimeAtRiskDef.html" class="external-link">createTimeAtRiskDef</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span>, startWith<span class="op">=</span><span class="st">"start"</span>, endWith<span class="op">=</span><span class="st">"end"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createTimeAtRiskDef.html" class="external-link">createTimeAtRiskDef</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">2</span>, startWith<span class="op">=</span><span class="st">"start"</span>, endWith<span class="op">=</span><span class="st">"start"</span>, endOffset <span class="op">=</span> <span class="fl">365</span><span class="op">)</span></span>
<span><span class="op">)</span>;</span>
<span></span>
<span><span class="va">analysis1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createIncidenceAnalysis.html" class="external-link">createIncidenceAnalysis</a></span><span class="op">(</span>targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>                                     outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                                     tars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">irDesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createIncidenceDesign.html" class="external-link">createIncidenceDesign</a></span><span class="op">(</span>targetDefs <span class="op">=</span> <span class="va">targets</span>,</span>
<span>                                  outcomeDefs <span class="op">=</span> <span class="va">outcomes</span>,</span>
<span>                                  tars<span class="op">=</span><span class="va">tars</span>,</span>
<span>                                  analysisList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">analysis1</span><span class="op">)</span>,</span>
<span>                                  strataSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/CohortIncidence/man/createStrataSettings.html" class="external-link">createStrataSettings</a></span><span class="op">(</span></span>
<span>                                    byYear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    byGender <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohortIncidenceModuleSpecifications</span> <span class="op">&lt;-</span> <span class="fu">createCohortIncidenceModuleSpecifications</span><span class="op">(</span></span>
<span>  irDesign <span class="op">=</span> <span class="va">irDesign</span><span class="op">$</span><span class="fu">toList</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="characterization-module-settings">Characterization Module Settings<a class="anchor" aria-label="anchor" href="#characterization-module-settings"></a>
</h3>
<p>The following code creates the
<code>characterizationModuleSpecifications</code> to perform an
characterization analysis for the target cohorts and outcome in this
study.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/OHDSI/CharacterizationModule/v0.0.1/SettingsFunctions.R"</span><span class="op">)</span></span>
<span><span class="va">characterizationModuleSpecifications</span> <span class="op">&lt;-</span> <span class="fu">createCharacterizationModuleSpecifications</span><span class="op">(</span>targetIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                                                   outcomeIds <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                                                                   covariateSettings <span class="op">=</span></span>
<span>                                                                                     <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createCovariateSettings.html" class="external-link">createCovariateSettings</a></span><span class="op">(</span></span>
<span>                                                                                       useDemographicsAge <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsAgeGroup <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsGender <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsRace <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsEthnicity <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsIndexYear <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsIndexMonth <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsPriorObservationTime <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsPostObservationTime <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDemographicsTimeInCohort <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useConditionGroupEraLongTerm  <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useDrugGroupEraLongTerm <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       useProcedureOccurrenceLongTerm <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                                                                       longTermStartDays <span class="op">=</span> <span class="op">-</span><span class="fl">365</span>,</span>
<span>                                                                                       endDays <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                                                                                   dechallengeStopInterval <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                                                                   dechallengeEvaluationWindow <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                                                                   riskWindowStart <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                                                   startAnchor <span class="op">=</span> <span class="st">"cohort start"</span>,</span>
<span>                                                                                   riskWindowEnd <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                                                                   endAnchor <span class="op">=</span> <span class="st">"cohort end"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cohortmethod-module-settings">CohortMethod Module Settings<a class="anchor" aria-label="anchor" href="#cohortmethod-module-settings"></a>
</h3>
<p>The following code creates the
<code>cohortMethodModuleSpecifications</code> to perform a comparative
cohort analysis for this study.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/CohortMethod" class="external-link">CohortMethod</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/OHDSI/CohortMethodModule/v0.0.4/SettingsFunctions.R"</span><span class="op">)</span></span>
<span><span class="va">negativeControlOutcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">ncoCohortSet</span><span class="op">$</span><span class="va">cohortId</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">createOutcome</span>,</span>
<span>  outcomeOfInterest <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trueEffectSize <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  priorOutcomeLookback <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcomesOfInterest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">createOutcome</span>,</span>
<span>  outcomeOfInterest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span></span>
<span>  <span class="va">negativeControlOutcomes</span>,</span>
<span>  <span class="va">outcomesOfInterest</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tcos1</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createTargetComparatorOutcomes.html" class="external-link">createTargetComparatorOutcomes</a></span><span class="op">(</span></span>
<span>  targetId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  comparatorId <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="va">outcomes</span>,</span>
<span>  excludedCovariateConceptIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1118084</span>, <span class="fl">1124300</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tcos2</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createTargetComparatorOutcomes.html" class="external-link">createTargetComparatorOutcomes</a></span><span class="op">(</span></span>
<span>  targetId <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  comparatorId <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="va">outcomes</span>,</span>
<span>  excludedCovariateConceptIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1118084</span>, <span class="fl">1124300</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">targetComparatorOutcomesList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">tcos1</span>, <span class="va">tcos2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covarSettings</span> <span class="op">&lt;-</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createDefaultCovariateSettings.html" class="external-link">createDefaultCovariateSettings</a></span><span class="op">(</span>addDescendantsToExclude <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">getDbCmDataArgs</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createGetDbCohortMethodDataArgs.html" class="external-link">createGetDbCohortMethodDataArgs</a></span><span class="op">(</span></span>
<span>  washoutPeriod <span class="op">=</span> <span class="fl">183</span>,</span>
<span>  firstExposureOnly <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  removeDuplicateSubjects <span class="op">=</span> <span class="st">"remove all"</span>,</span>
<span>  maxCohortSize <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="va">covarSettings</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createStudyPopArgs</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createCreateStudyPopulationArgs.html" class="external-link">createCreateStudyPopulationArgs</a></span><span class="op">(</span></span>
<span>  minDaysAtRisk <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  riskWindowStart <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  startAnchor <span class="op">=</span> <span class="st">"cohort start"</span>,</span>
<span>  riskWindowEnd <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"cohort end"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">matchOnPsArgs</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createMatchOnPsArgs.html" class="external-link">createMatchOnPsArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fitOutcomeModelArgs</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createFitOutcomeModelArgs.html" class="external-link">createFitOutcomeModelArgs</a></span><span class="op">(</span>modelType <span class="op">=</span> <span class="st">"cox"</span><span class="op">)</span></span>
<span><span class="va">createPsArgs</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createCreatePsArgs.html" class="external-link">createCreatePsArgs</a></span><span class="op">(</span></span>
<span>  stopOnError <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu">Cyclops</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Cyclops/man/createControl.html" class="external-link">createControl</a></span><span class="op">(</span>cvRepetitions <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">computeSharedCovBalArgs</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createComputeCovariateBalanceArgs.html" class="external-link">createComputeCovariateBalanceArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">computeCovBalArgs</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createComputeCovariateBalanceArgs.html" class="external-link">createComputeCovariateBalanceArgs</a></span><span class="op">(</span></span>
<span>  covariateFilter <span class="op">=</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/getDefaultTable1Specifications.html" class="external-link">getDefaultTable1Specifications</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cmAnalysis1</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createCmAnalysis.html" class="external-link">createCmAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"No matching, simple outcome model"</span>,</span>
<span>  getDbCohortMethodDataArgs <span class="op">=</span> <span class="va">getDbCmDataArgs</span>,</span>
<span>  createStudyPopArgs <span class="op">=</span> <span class="va">createStudyPopArgs</span>,</span>
<span>  fitOutcomeModelArgs <span class="op">=</span> <span class="va">fitOutcomeModelArgs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cmAnalysis2</span> <span class="op">&lt;-</span> <span class="fu">CohortMethod</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortMethod/reference/createCmAnalysis.html" class="external-link">createCmAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Matching on ps and covariates, simple outcomeModel"</span>,</span>
<span>  getDbCohortMethodDataArgs <span class="op">=</span> <span class="va">getDbCmDataArgs</span>,</span>
<span>  createStudyPopArgs <span class="op">=</span> <span class="va">createStudyPopArgs</span>,</span>
<span>  createPsArgs <span class="op">=</span> <span class="va">createPsArgs</span>,</span>
<span>  matchOnPsArgs <span class="op">=</span> <span class="va">matchOnPsArgs</span>,</span>
<span>  computeSharedCovariateBalanceArgs <span class="op">=</span> <span class="va">computeSharedCovBalArgs</span>,</span>
<span>  computeCovariateBalanceArgs <span class="op">=</span> <span class="va">computeCovBalArgs</span>,</span>
<span>  fitOutcomeModelArgs <span class="op">=</span> <span class="va">fitOutcomeModelArgs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cmAnalysisList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cmAnalysis1</span>, <span class="va">cmAnalysis2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">analysesToExclude</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span></span>
<span><span class="va">cohortMethodModuleSpecifications</span> <span class="op">&lt;-</span> <span class="fu">createCohortMethodModuleSpecifications</span><span class="op">(</span></span>
<span>  cmAnalysisList <span class="op">=</span> <span class="va">cmAnalysisList</span>,</span>
<span>  targetComparatorOutcomesList <span class="op">=</span> <span class="va">targetComparatorOutcomesList</span>,</span>
<span>  analysesToExclude <span class="op">=</span> <span class="va">analysesToExclude</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="selfcontrolledcaseseries-module-settings">SelfControlledCaseSeries Module Settings<a class="anchor" aria-label="anchor" href="#selfcontrolledcaseseries-module-settings"></a>
</h3>
<p>The following code creates the
<code>cohortMethodModuleSpecifications</code> to perform a comparative
cohort analysis for this study.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/OHDSI/SelfControlledCaseSeries" class="external-link">SelfControlledCaseSeries</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/OHDSI/SelfControlledCaseSeriesModule/v0.0.2/SettingsFunctions.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exposures-outcomes -----------------------------------------------------------</span></span>
<span><span class="va">negativeControlOutcomeIds</span> <span class="op">&lt;-</span> <span class="va">ncoCohortSet</span><span class="op">$</span><span class="va">cohortId</span></span>
<span><span class="va">outcomeOfInterestIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">exposureOfInterestIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exposuresOutcomeList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">exposureOfInterestId</span> <span class="kw">in</span> <span class="va">exposureOfInterestIds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">outcomeOfInterestId</span> <span class="kw">in</span> <span class="va">outcomeOfInterestIds</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">exposuresOutcomeList</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">exposuresOutcomeList</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createExposuresOutcome.html" class="external-link">createExposuresOutcome</a></span><span class="op">(</span></span>
<span>      outcomeId <span class="op">=</span> <span class="va">outcomeOfInterestId</span>,</span>
<span>      exposures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createExposure.html" class="external-link">createExposure</a></span><span class="op">(</span>exposureId <span class="op">=</span> <span class="va">exposureOfInterestId</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">negativeControlOutcomeId</span> <span class="kw">in</span> <span class="va">negativeControlOutcomeIds</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">exposuresOutcomeList</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">exposuresOutcomeList</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createExposuresOutcome.html" class="external-link">createExposuresOutcome</a></span><span class="op">(</span></span>
<span>      outcomeId <span class="op">=</span> <span class="va">negativeControlOutcomeId</span>,</span>
<span>      exposures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createExposure.html" class="external-link">createExposure</a></span><span class="op">(</span>exposureId <span class="op">=</span> <span class="va">exposureOfInterestId</span>, trueEffectSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Analysis settings ------------------------------------------------------------</span></span>
<span><span class="va">getDbSccsDataArgs</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createGetDbSccsDataArgs.html" class="external-link">createGetDbSccsDataArgs</a></span><span class="op">(</span></span>
<span>  studyStartDate <span class="op">=</span> <span class="st">""</span>,</span>
<span>  studyEndDate <span class="op">=</span> <span class="st">"20191130"</span>,</span>
<span>  maxCasesPerOutcome <span class="op">=</span> <span class="fl">1e6</span>,</span>
<span>  useNestingCohort <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nestingCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  deleteCovariatesSmallCount <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createStudyPopulation6AndOlderArgs</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createCreateStudyPopulationArgs.html" class="external-link">createCreateStudyPopulationArgs</a></span><span class="op">(</span></span>
<span>  minAge <span class="op">=</span> <span class="fl">18</span>,</span>
<span>  naivePeriod <span class="op">=</span> <span class="fl">365</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covarPreExp</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createEraCovariateSettings.html" class="external-link">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Pre-exposure"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="st">"exposureId"</span>,</span>
<span>  start <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>,</span>
<span>  end <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era start"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covarExposureOfInt</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createEraCovariateSettings.html" class="external-link">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Main"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="st">"exposureId"</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  startAnchor <span class="op">=</span> <span class="st">"era start"</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era end"</span>,</span>
<span>  profileLikelihood <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  exposureOfInterest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">calendarTimeSettings</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createCalendarTimeCovariateSettings.html" class="external-link">createCalendarTimeCovariateSettings</a></span><span class="op">(</span></span>
<span>  calendarTimeKnots <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  allowRegularization <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  computeConfidenceIntervals <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">seasonalitySettings</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createSeasonalityCovariateSettings.html" class="external-link">createSeasonalityCovariateSettings</a></span><span class="op">(</span></span>
<span>  seasonKnots <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  allowRegularization <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  computeConfidenceIntervals <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createSccsIntervalDataArgs</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createCreateSccsIntervalDataArgs.html" class="external-link">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>  eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covarPreExp</span>, <span class="va">covarExposureOfInt</span><span class="op">)</span>,</span>
<span>  seasonalityCovariateSettings <span class="op">=</span> <span class="va">seasonalitySettings</span>,</span>
<span>  calendarTimeCovariateSettings <span class="op">=</span> <span class="va">calendarTimeSettings</span>,</span>
<span>  minCasesForTimeCovariates <span class="op">=</span> <span class="fl">100000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fitSccsModelArgs</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createFitSccsModelArgs.html" class="external-link">createFitSccsModelArgs</a></span><span class="op">(</span></span>
<span>  control <span class="op">=</span> <span class="fu">Cyclops</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Cyclops/man/createControl.html" class="external-link">createControl</a></span><span class="op">(</span></span>
<span>    cvType <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>    selectorType <span class="op">=</span> <span class="st">"byPid"</span>,</span>
<span>    startingVariance <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    resetCoefficients <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    noiseLevel <span class="op">=</span> <span class="st">"quiet"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsAnalysis1</span> <span class="op">&lt;-</span> <span class="fu">SelfControlledCaseSeries</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SelfControlledCaseSeries/man/createSccsAnalysis.html" class="external-link">createSccsAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"SCCS age 18-"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="va">getDbSccsDataArgs</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="va">createStudyPopulation6AndOlderArgs</span>,</span>
<span>  createIntervalDataArgs <span class="op">=</span> <span class="va">createSccsIntervalDataArgs</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="va">fitSccsModelArgs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsAnalysisList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sccsAnalysis1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SCCS module specs ------------------------------------------------------------</span></span>
<span><span class="va">sccsModuleSpecifications</span> <span class="op">&lt;-</span> <span class="fu">creatSelfControlledCaseSeriesModuleSpecifications</span><span class="op">(</span></span>
<span>  sccsAnalysisList <span class="op">=</span> <span class="va">sccsAnalysisList</span>,</span>
<span>  exposuresOutcomeList <span class="op">=</span> <span class="va">exposuresOutcomeList</span>,</span>
<span>  combineDataFetchAcrossOutcomes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="patientlevelprediction-module-settings">PatientLevelPrediction Module Settings<a class="anchor" aria-label="anchor" href="#patientlevelprediction-module-settings"></a>
</h3>
<p>The following code creates the <code>plpModuleSpecifications</code>
to perform a self-controlled case series analysis for this study.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/OHDSI/PatientLevelPredictionModule/v0.0.1/SettingsFunctions.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">makeModelDesignSettings</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">targetId</span>, <span class="va">outcomeId</span>, <span class="va">popSettings</span>, <span class="va">covarSettings</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span>  <span class="fu">PatientLevelPrediction</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PatientLevelPrediction/reference/createModelDesign.html" class="external-link">createModelDesign</a></span><span class="op">(</span></span>
<span>    targetId <span class="op">=</span> <span class="va">targetId</span>, </span>
<span>    outcomeId <span class="op">=</span> <span class="va">outcomeId</span>, </span>
<span>    restrictPlpDataSettings <span class="op">=</span> <span class="fu">PatientLevelPrediction</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PatientLevelPrediction/reference/createRestrictPlpDataSettings.html" class="external-link">createRestrictPlpDataSettings</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    populationSettings <span class="op">=</span> <span class="va">popSettings</span>, </span>
<span>    covariateSettings <span class="op">=</span> <span class="va">covarSettings</span>, </span>
<span>    preprocessSettings <span class="op">=</span> <span class="fu">PatientLevelPrediction</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PatientLevelPrediction/reference/createPreprocessSettings.html" class="external-link">createPreprocessSettings</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    modelSettings <span class="op">=</span> <span class="fu">PatientLevelPrediction</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PatientLevelPrediction/reference/setLassoLogisticRegression.html" class="external-link">setLassoLogisticRegression</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    splitSettings <span class="op">=</span> <span class="fu">PatientLevelPrediction</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PatientLevelPrediction/reference/createDefaultSplitSetting.html" class="external-link">createDefaultSplitSetting</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    runCovariateSummary <span class="op">=</span> <span class="cn">T</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plpPopulationSettings</span> <span class="op">&lt;-</span> <span class="fu">PatientLevelPrediction</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PatientLevelPrediction/reference/createStudyPopulationSettings.html" class="external-link">createStudyPopulationSettings</a></span><span class="op">(</span></span>
<span>  startAnchor <span class="op">=</span> <span class="st">"cohort start"</span>,</span>
<span>  riskWindowStart <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"cohort start"</span>,</span>
<span>  riskWindowEnd <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  minTimeAtRisk <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plpCovarSettings</span> <span class="op">&lt;-</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createDefaultCovariateSettings.html" class="external-link">createDefaultCovariateSettings</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">modelDesignList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">exposureOfInterestIds</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">outcomeOfInterestIds</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">modelDesignList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span></span>
<span>      <span class="va">modelDesignList</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="fu">makeModelDesignSettings</span><span class="op">(</span></span>
<span>          targetId <span class="op">=</span> <span class="va">exposureOfInterestIds</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>          outcomeId <span class="op">=</span> <span class="va">outcomeOfInterestIds</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>,</span>
<span>          popSettings <span class="op">=</span> <span class="va">plpPopulationSettings</span>,</span>
<span>          covarSettings <span class="op">=</span> <span class="va">plpCovarSettings</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plpModuleSpecifications</span> <span class="op">&lt;-</span> <span class="fu">createPatientLevelPredictionModuleSpecifications</span><span class="op">(</span>modelDesignList <span class="op">=</span> <span class="va">modelDesignList</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="strategus-analysis-specifications">Strategus Analysis Specifications<a class="anchor" aria-label="anchor" href="#strategus-analysis-specifications"></a>
</h2>
<p>Finally, we will use the various shared resources and module
specifications to construct the full set of analysis specifications and
save it to the file system in JSON format.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analysisSpecifications</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEmptyAnalysisSpecificiations.html">createEmptyAnalysisSpecificiations</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addSharedResources.html">addSharedResources</a></span><span class="op">(</span><span class="va">cohortDefinitionSharedResource</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addSharedResources.html">addSharedResources</a></span><span class="op">(</span><span class="va">ncoSharedResource</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addModuleSpecifications.html">addModuleSpecifications</a></span><span class="op">(</span><span class="va">cohortGeneratorModuleSpecifications</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addModuleSpecifications.html">addModuleSpecifications</a></span><span class="op">(</span><span class="va">cohortDiagnosticsModuleSpecifications</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addModuleSpecifications.html">addModuleSpecifications</a></span><span class="op">(</span><span class="va">cohortIncidenceModuleSpecifications</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addModuleSpecifications.html">addModuleSpecifications</a></span><span class="op">(</span><span class="va">characterizationModuleSpecifications</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addModuleSpecifications.html">addModuleSpecifications</a></span><span class="op">(</span><span class="va">cohortMethodModuleSpecifications</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addModuleSpecifications.html">addModuleSpecifications</a></span><span class="op">(</span><span class="va">sccsModuleSpecifications</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/addModuleSpecifications.html">addModuleSpecifications</a></span><span class="op">(</span><span class="va">plpModuleSpecifications</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ParallelLogger</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ParallelLogger/reference/saveSettingsToJson.html" class="external-link">saveSettingsToJson</a></span><span class="op">(</span><span class="va">analysisSpecifications</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">analysisSettingsPath</span>, <span class="va">params</span><span class="op">$</span><span class="va">analysisSettingsFileName</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martijn Schuemie, Anthony Sena.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
