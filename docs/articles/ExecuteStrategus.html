<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Execute Strategus • Strategus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Execute Strategus">
<meta property="og:description" content="Strategus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Strategus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CreatingAnalysisSpecification.html">Creating Analysis Specification</a>
    </li>
    <li>
      <a href="../articles/CreatingModules.html">Creating Strategus Modules</a>
    </li>
    <li>
      <a href="../articles/ExecuteStrategus.html">Execute Strategus</a>
    </li>
    <li>
      <a href="../articles/IntroductionToStrategus.html">Introduction to Strategus</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/Strategus/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Execute Strategus</h1>
                        <h4 data-toc-skip class="author">Anthony G.
Sena</h4>
            
            <h4 data-toc-skip class="date">2023-04-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/Strategus/blob/HEAD/vignettes/ExecuteStrategus.Rmd" class="external-link"><code>vignettes/ExecuteStrategus.Rmd</code></a></small>
      <div class="hidden name"><code>ExecuteStrategus.Rmd</code></div>

    </div>

    
    
<p>A Strategus study is defined by <em>analysis specifications</em>.
These specifications describe which modules to run, with which settings.
The ‘Creating Analysis Specification’ vignette describes how to create
analysis specifications. In this vignette, we demonstrate how to run a
study once it is specified.</p>
<div class="section level2">
<h2 id="creating-execution-settings">Creating execution settings<a class="anchor" aria-label="anchor" href="#creating-execution-settings"></a>
</h2>
<p>In addition to analysis specifications, Strategus also requires
<em>execution settings</em>. The execution settings specify how the
study should be executed in a specific environment, for example how to
connect to a database, and what local folders to use. Many Strategus
studies run against data in the OMOP Common Data Model (CDM), and in
this vignette we focus on this type of studies. (Other studies, such as
meta-analyses, may run against results data instead). In this example,
we will make use of the <a href="https://github.com/ohdsi/eunomia" class="external-link">Eunomia</a> data set which is an
OMOP CDM with simulated data used for example purposes. When running a
study against your own CDM data, you will need to specify the database
connection details for your environment. Execution settings for studies
against the CDM can be created using
<code><a href="../reference/createCdmExecutionSettings.html">createCdmExecutionSettings()</a></code>.</p>
<p>Note that Strategus uses <a href="https://r-lib.github.io/keyring/index.html" class="external-link">keyring</a> to store
the connection information securely, so that sensitive information is
not stored directly in the <code>executionSettings</code> variable.</p>
<div class="section level3">
<h3 id="storing-the-connection-details">Storing the connection details<a class="anchor" aria-label="anchor" href="#storing-the-connection-details"></a>
</h3>
<p>In this example, we first create a <code>connectionDetails</code>
reference for Eunomia. In your environment, the
<code>connectionDetails</code> would be specific to your OMOP CDM
connection.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/Strategus" class="external-link">Strategus</a></span><span class="op">)</span></span>
<span><span class="va">folder</span> <span class="op">&lt;-</span> <span class="st">"c:/strategus"</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note: specifying the `databaseFile` so the Eunomia database is permanent, not temporary:</span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">Eunomia</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Eunomia/man/getEunomiaConnectionDetails.html" class="external-link">getEunomiaConnectionDetails</a></span><span class="op">(</span></span>
<span>  databaseFile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputFolder</span>, <span class="st">"cdm.sqlite"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next we will use <code>Strategus</code> to store the connection
details and provide a <code>connectionDetailsReference</code> that
Strategus will use to look up the connection details.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/storeConnectionDetails.html">storeConnectionDetails</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  connectionDetailsReference <span class="op">=</span> <span class="st">"eunomia"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that we only need to store connection details once. We can
re-use these details in all future studies.</p>
</div>
<div class="section level3">
<h3 id="creating-an-execution-settings-object">Creating an execution settings object<a class="anchor" aria-label="anchor" href="#creating-an-execution-settings-object"></a>
</h3>
<p>Next, we will use <code>Strategus</code> to create the CDM execution
settings. The <code>connectionDetailsReference</code> refers to the
connection details we stored earlier:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">executionSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCdmExecutionSettings.html">createCdmExecutionSettings</a></span><span class="op">(</span></span>
<span>  connectionDetailsReference <span class="op">=</span> <span class="st">"eunomia"</span>,</span>
<span>  workDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohortTableNames <span class="op">=</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/getCohortTableNames.html" class="external-link">getCohortTableNames</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  workFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputFolder</span>, <span class="st">"work_folder"</span><span class="op">)</span>,</span>
<span>  resultsFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputFolder</span>, <span class="st">"results_folder"</span><span class="op">)</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can write out the execution settings to the file system
to capture this information.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ParallelLogger</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ParallelLogger/reference/saveSettingsToJson.html" class="external-link">saveSettingsToJson</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">executionSettings</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputFolder</span>, <span class="st">"eunomiaExecutionSettings.json"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="executing-the-study">Executing the study<a class="anchor" aria-label="anchor" href="#executing-the-study"></a>
</h2>
<div class="section level3">
<h3 id="specifying-the-instantiated-modules-folder">Specifying the instantiated modules folder<a class="anchor" aria-label="anchor" href="#specifying-the-instantiated-modules-folder"></a>
</h3>
<p>Strategus studies use modules to perform the analytics, and each
module has a version. Different studies can use the same modules, but a
single study can only use one version of a particular module. These
modules need to be instantiated before they can be executed, a sometimes
time-consuming task. We must specify a global location where these
modules will be instantiated so that, once a module is instantiated, it
can be used in all future studies:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"INSTANTIATED_MODULES_FOLDER"</span> <span class="op">=</span> <span class="st">"c:/strategus/modules"</span><span class="op">)</span></span></code></pre></div>
<p>We recommend adding this environmental variable to your
<code>.renviron</code> file, so it is always set.</p>
</div>
<div class="section level3">
<h3 id="running-the-study">Running the study<a class="anchor" aria-label="anchor" href="#running-the-study"></a>
</h3>
<p>For this study, we will use analysis specifications created
elsewhere, and the execution settings we created earlier:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analysisSpecifications</span> <span class="op">&lt;-</span> <span class="fu">ParallelLogger</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ParallelLogger/reference/loadSettingsFromJson.html" class="external-link">loadSettingsFromJson</a></span><span class="op">(</span></span>
<span>  fileName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata/analysisSpecification.json"</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"Strategus"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">executionSettings</span> <span class="op">&lt;-</span> <span class="fu">ParallelLogger</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ParallelLogger/reference/loadSettingsFromJson.html" class="external-link">loadSettingsFromJson</a></span><span class="op">(</span></span>
<span>  fileName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputFolder</span>, <span class="st">"eunomiaExecutionSettings.json"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And finally we execute the study:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/execute.html">execute</a></span><span class="op">(</span></span>
<span>  analysisSpecifications <span class="op">=</span> <span class="va">analysisSpecifications</span>,</span>
<span>  executionSettings <span class="op">=</span> <span class="va">executionSettings</span>,</span>
<span>  executionScriptFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputFolder</span>, <span class="st">"script_folder"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will first instantiate all the modules if they haven’t already
been instantiated, and will then execute each module in sequence
according to the analysis specifications. The results will appear in
subfolders of the ‘results_folder’, as specified in the execution
settings.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martijn Schuemie, Anthony Sena.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
